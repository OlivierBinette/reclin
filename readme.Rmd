---
title: "reclin introduction"
author: "Jan van der Laan"
output: html_document
---

```{r}
library(devtools)
load_all()
cis <- read.csv("csv/cis.csv", stringsAsFactors = FALSE)
prd <- read.csv("csv/prd.csv", stringsAsFactors = FALSE)


p  <- pairs_blocking(cis, prd, blocking_var = "ENUMPC", large = TRUE)

p2 <- pairs_compare(p, by = c("PERNAME1", "PERNAME2", "SEX", "DOB_DAY", 
  "DOB_MON", "DOB_YEAR"), comparators = list(PERNAME1 = jaro_winkler(), 
    PERNAME2 = jaro_winkler()))

p3 <- score_simsum(p2)


m <- problink_em(p3)

w <- predict(m, newdata = p3)

p4 <- score_problink(p3, m)

p5 <- select_threshold(p4, "weight", threshold = 4.5)
p5 <- select_greedy(p4, "weight", var = "greedy", threshold = 4.5)
p5 <- select_n_to_m(p5, "weight", var = "ntom", threshold = 4.5)

tst <- as.data.frame(p5[p5$ntom, c("x", "y")])
table(duplicated(tst$x))
table(duplicated(tst$y))


tst <- as.data.frame(p5[p5$greedy, c("x", "y")])
table(duplicated(tst$x))
table(duplicated(tst$y))

table(p5$ntom, p5$greedy)

res <- link(p5)



p5 <- add_from_x(p5, x_id = "PERSON_ID")
p5 <- add_from_y(p5, y_id = "PERSON_ID")
p5$true <- p5$x_id == p5$y_id

table(p5$true, p5$greedy)
table(p5$true, p5$ntom)


# TODO: one-to-one lp
# TODO: variabele uit x/y toevoegen aan pairs




```